function spaceHandler(){spacePress&&socket.emit("spacePressed",mav.client)}function oneHandler(){onePress&&socket.emit("onePressed",mav.client)}function twoHandler(){twoPress&&socket.emit("twoPressed",mav.client)}function Camera(e,t,a){this.x=0,this.y=0,this.width=t,this.height=a}function Client(e,t,a,i,s,n,o,c,l,r,m,h){this.name=e,this.plane=t,this.id=a,this.x=i,this.y=s,this.angle=o,this.speed=n,this.health=c,this.points=l,this.ammo=r,this.homingMissiles=m,this.missiles=h}function Maverick(e,t,a,i,s){this.ctx=e,this.camera=t,this.client=a,this.players=i,this.bullets=s}function hurtPlayer(){socket.emit("hurtPlayer",mav.client)}function spawnComputerPlayer(){socket.emit("spawnComputerPlayer",mav.client)}function reloadHomingMissiles(){socket.emit("reloadHomingMissiles",mav.client)}console.log("Maverick 2D!"),$("#reload").hide();var socket=io();console.log(socket);var canvas=$("#canvas")[0],ctx=canvas.getContext("2d"),angle=0,rotate=0,lastFrame=Date.now(),frameTime=0,players=[],bullets=[],availableItems=[],leaderboard=[],homingMissiles=[],missiles=[],plane,leftPress,rightPress,spacePress,onePress,twoPress,upPress,downPress;$(document).on("keydown",function(e){players.length>0&&(39!==e.keyCode&&68!==e.keyCode||(rightPress=!0),37!==e.keyCode&&65!==e.keyCode||(leftPress=!0),38!==e.keyCode&&87!==e.keyCode||(upPress=!0),spacePress||32!==e.keyCode||(spacePress=!0,spaceHandler()),80===e.keyCode&&spawnComputerPlayer(),(!onePress&&49===e.keyCode||75===e.keyCode)&&(onePress=!0,oneHandler()),(!twoPress&&50===e.keyCode||76===e.keyCode)&&(twoPress=!0,twoHandler()),16!==e.keyCode&&74!==e.keyCode||(socket.emit("reload",mav.client),mav.client.ammo<10&&(mav.reloading=!0,setTimeout(function(){mav.reloading=!1},3e3))))}),$(document).on("keyup",function(e){players.length>0&&(39!==e.keyCode&&68!==e.keyCode||(rightPress=!1),37!==e.keyCode&&65!==e.keyCode||(leftPress=!1),38!==e.keyCode&&87!==e.keyCode||(upPress=!1),32===e.keyCode&&(spacePress=!1,spaceHandler()),49!==e.keyCode&&75!==e.keyCode||(onePress=!1,oneHandler()),50!==e.keyCode&&76!==e.keyCode||(twoPress=!1,twoHandler()))}),$("#reload").on("click",function(){socket.emit("respawn",mav.client),$("#menu").hide()});var spitfire=new Image;spitfire.src="/images/spitfire.png";var zero=new Image;zero.src="/images/zero.png";var mustang=new Image;mustang.src="/images/mustang.png";var lightning=new Image;lightning.src="/images/lightning.png";var messerschmitt=new Image;messerschmitt.src="/images/messerschmitt.png";var tigercat=new Image;tigercat.src="/images/tigercat.png";var planes=[spitfire,zero,mustang,lightning,messerschmitt,tigercat],bulletImg=new Image;bulletImg.src="/images/bullet.png";var tileMap=new Image;tileMap.src="/images/map-2.png";var healthImg=new Image;healthImg.src="/images/health.png";var homingMissileImg=new Image;homingMissileImg.src="/images/homing-missile.png";var missileImg=new Image;missileImg.src="/images/missile.png";var map={cols:10,rows:10,tileSize:500};Camera.prototype.move=function(e,t){this.x=e,this.y=t},Maverick.prototype.updateCam=function(e){this.camLeftBound=this.client.x-canvas.width/2,this.camRightBound=this.client.x+canvas.width/2,this.camTopBound=this.client.y-canvas.height/2,this.camBottomBound=this.client.y+canvas.height/2,this.camera.move(this.client.x,this.client.y)},Maverick.prototype.keyPressHandler=function(){var e=this;leftPress&&socket.emit("leftPressed",e.client),rightPress&&socket.emit("rightPressed",e.client),upPress&&socket.emit("upPressed",e.client),upPress||socket.emit("downPressed",e.client)},Maverick.prototype.ping=function(){this.startPingTime=Date.now(),socket.emit("ping")},Maverick.prototype.run=function(){this.tick();var e=this;setInterval(function(){e.keyPressHandler.call(e)},30),setInterval(function(){e.ping.call(e)},150)},Maverick.prototype.tick=function(e){window.requestAnimationFrame(this.tick.bind(this)),this.render()},Maverick.prototype.render=function(){rotate+=3;var e=10,t=Date.now(),a=t-lastFrame;frameTime+=(a-frameTime)/e,this.fps=(1e3/frameTime).toFixed(),lastFrame=t,this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,this.updateCam(),this.drawMap(),this.drawAvailableItems(),this.drawBullets(),this.drawHomingMissiles(),this.drawMissiles(),this.drawEnemies(),this.drawPlane(),this.drawLeaderboard(),this.drawLeaders(),this.drawAmmo(),this.drawDiagnostics()},Maverick.prototype.drawDiagnostics=function(){this.ctx.fillStyle="black",this.ctx.globalAlpha=.3,this.ctx.fillRect(20,240,300,68),this.ctx.globalAlpha=1,this.ctx.fillStyle="white",this.ctx.font="18px 'Lucida Grande'",this.ctx.fillText("FPS: "+this.fps,32,268),this.ctx.fillText("Ping: "+this.latency+" milliseconds",32,294)},Maverick.prototype.drawMap=function(){this.ctx.save(),this.ctx.drawImage(tileMap,0,0,5e3,5e3,-mav.camLeftBound,-mav.camTopBound,5e3,5e3),this.ctx.restore()},Maverick.prototype.drawPlane=function(){var e;e=this.client.health>14?"#2ecc71":this.client.health>7?"#f1c40f":"#e74c3c",this.ctx.save(),this.ctx.translate(canvas.width/2,canvas.height/2),this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.font="18px 'Lucida Grande'",this.ctx.fillStyle="blue",this.ctx.fillText(this.client.name,0,-90),this.ctx.fillStyle=e,this.ctx.fillRect(-50,-85,5*this.client.health,10),this.ctx.rotate(Math.PI/180*this.client.angle),this.ctx.drawImage(planes[this.client.plane],-60,-60,120,120),this.ctx.restore()},Maverick.prototype.drawEnemies=function(){var e=this;players.forEach(function(t){if(t.id!==e.client.id&&t.x<e.camRightBound+60&&t.x>e.camLeftBound-60&&t.y<e.camBottomBound+120&&t.y>e.camTopBound-60){var a;a=t.health>14?"#2ecc71":t.health>7?"#f1c40f":"#e74c3c",e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.textAlign="center",e.ctx.textBaseline="bottom",e.ctx.font="18px 'Lucida Grande'",e.ctx.fillStyle="#e74c3c",e.ctx.fillText(t.name,0,-90),e.ctx.fillStyle=a,e.ctx.fillRect(-50,-85,5*t.health,10),e.ctx.rotate(Math.PI/180*t.angle),e.ctx.drawImage(planes[t.plane],-60,-60,120,120),e.ctx.restore()}})},Maverick.prototype.drawBullets=function(){var e=this;bullets.length>=1&&bullets.forEach(function(t){t.x<e.camRightBound&&t.x>e.camLeftBound&&t.y<e.camBottomBound&&t.y>e.camTopBound&&(e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.rotate(Math.PI/180*t.angle),e.ctx.drawImage(bulletImg,-12,-12,24,24),e.ctx.restore())})},Maverick.prototype.drawHomingMissiles=function(){var e=this;homingMissiles.length>=1&&homingMissiles.forEach(function(t){t.x<e.camRightBound&&t.x>e.camLeftBound&&t.y<e.camBottomBound&&t.y>e.camTopBound&&(e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.rotate(Math.PI/180*t.angle),e.ctx.drawImage(homingMissileImg,-16,-32,32,64),e.ctx.restore())})},Maverick.prototype.drawMissiles=function(){var e=this;missiles.length>=1&&missiles.forEach(function(t){t.x<e.camRightBound&&t.x>e.camLeftBound&&t.y<e.camBottomBound&&t.y>e.camTopBound&&(e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.rotate(Math.PI/180*t.angle),e.ctx.drawImage(missileImg,-16,-32,32,64),e.ctx.restore())})},Maverick.prototype.drawHealthPacks=function(){var e=this;healthPacks.length>=1&&healthPacks.forEach(function(t){t.x<e.camRightBound&&t.x>e.camLeftBound&&t.y<e.camBottomBound&&t.y>e.camTopBound&&(e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.drawImage(healthImg,-24,-24,48,48),e.ctx.restore())})},Maverick.prototype.drawAvailableItems=function(){var e=this;availableItems.length>=1&&availableItems.forEach(function(t){t.x<e.camRightBound&&t.x>e.camLeftBound&&t.y<e.camBottomBound&&t.y>e.camTopBound&&(0===t.type&&(e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.drawImage(healthImg,-24,-24,48,48),e.ctx.restore()),1===t.type&&(e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.rotate(Math.PI/180*rotate),e.ctx.drawImage(missileImg,-16,-32,32,64),e.ctx.restore()),2===t.type&&(e.ctx.save(),e.ctx.translate(t.x-e.camLeftBound,t.y-e.camTopBound),e.ctx.rotate(Math.PI/180*rotate),e.ctx.drawImage(homingMissileImg,-16,-32,32,64),e.ctx.restore()))})},Maverick.prototype.drawAmmo=function(){for(var e=this,t=canvas.height-96,a=24,i=mav.client.ammo;i>0;i--)e.ctx.drawImage(bulletImg,a,t,64,64),a+=24;for(var i=mav.client.missiles;i>0;i--)e.ctx.drawImage(missileImg,a+48,t,32,64),a+=48;for(var i=mav.client.homingMissiles;i>0;i--)e.ctx.drawImage(homingMissileImg,a+48,t,32,64),a+=48;(mav.client.ammo<1||mav.reloading)&&(e.ctx.fillStyle="grey",e.ctx.font="36px 'Lucida Grande'",e.ctx.fillText("Reloading...",a+48,canvas.height-48))},Maverick.prototype.drawLeaderboard=function(){this.ctx.globalAlpha=.3,this.fillStyle="black",this.ctx.fillRect(20,20,300,200),this.ctx.globalAlpha=1},Maverick.prototype.drawLeaders=function(){var e=this,t=50;e.ctx.fillStyle="white",e.ctx.font="18px 'Lucida Grande'",e.ctx.fillText("Leaderboard:",105,50),e.ctx.fillStyle="black",leaderboard.forEach(function(a){t+=25,e.ctx.globalAlpha=1,e.ctx.fillStyle="white",e.ctx.font="18px 'Lucida Grande'",e.ctx.fillText("âœˆ "+a.name+": "+a.points+" pts",35,t),e.ctx.fillStyle="black"})},$("#start").on("click",function(){plane=$("#select").val();var e=new Client($("#name").val(),plane,socket.id);socket.emit("spawn",e)}),socket.on("joinGame",function(e){canvas.getContext("2d");console.log("Updated Settings:",e);var t=new Client(e.name,e.plane,e.id,e.x,e.y,e.speed,e.angle,e.health,e.points,e.ammo,e.homingMissiles,e.missiles),a=new Camera(map,canvas.width,canvas.height);mav=new Maverick(canvas.getContext("2d"),a,t),$("#menu").hide(),mav.run()}),socket.on("pong",function(){mav.latency=Date.now()-mav.startPingTime}),socket.on("rejoinGame",function(e){mav.client=e}),socket.on("movePlane",function(e){mav.client.x=e.x,mav.client.y=e.y,mav.client.speed=e.speed,mav.client.health=e.health,mav.client.angle=e.angle,mav.client.points=e.points,mav.client.ammo=e.ammo,mav.client.homingMissiles=e.homingMissiles,mav.client.missiles=e.missiles}),socket.on("moveBullets",function(e){bullets=e}),socket.on("moveHomingMissiles",function(e){homingMissiles=e}),socket.on("moveMissiles",function(e){missiles=e}),socket.on("updateItems",function(e){availableItems=e}),socket.on("updateAllPlayers",function(e){players=e}),socket.on("updateAllLeaderboards",function(e){leaderboard=e}),socket.on("shotFired",function(e){console.log(e.name,"is shooting!")}),socket.on("playerDie",function(e){console.log(e.name,"was shot down!"),e.id===mav.client.id&&($("#inputs").hide(),$("#start").hide(),$("#controls").hide(),$("#select").hide(),$("#reload").show(),$("#menu").show())});
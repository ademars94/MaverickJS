function Camera(t,e,i){this.x=0,this.y=0,this.width=e,this.height=i}function Client(t,e,i,a,s,n,c,o,l,r){this.name=t,this.plane=e,this.id=i,this.x=a,this.y=s,this.angle=c,this.speed=n,this.health=o,this.points=l,this.ammo=r}function Maverick(t,e,i,a,s){this.ctx=t,this.camera=e,this.client=i,this.players=a,this.bullets=s}console.log("Maverick 2D!"),$("#reload").hide();var socket=io();console.log(socket);var canvas=$("#canvas")[0],ctx=canvas.getContext("2d"),angle=0,players=[],bullets=[],leaderboard=[],plane,leftPress,rightPress,shiftPress,upPress,downPress;$(document).on("keydown",function(t){mav&&(68!==t.keyCode&&39!==t.keyCode||(rightPress=!0),65!==t.keyCode&&37!==t.keyCode||(leftPress=!0),38!==t.keyCode&&87!==t.keyCode||(upPress=!0),16===t.keyCode&&(shiftPress=!0))}),$(document).on("keyup",function(t){mav&&(68!==t.keyCode&&39!==t.keyCode||(rightPress=!1),65!==t.keyCode&&37!==t.keyCode||(leftPress=!1),38!==t.keyCode&&87!==t.keyCode||(upPress=!1),16===t.keyCode&&(shiftPress=!1))}),$("#reload").on("click",function(){socket.emit("respawn",mav.client),$("#menu").hide()});var spitfire=new Image;spitfire.src="/images/spitfire.png";var zero=new Image;zero.src="/images/zero.png";var mustang=new Image;mustang.src="/images/mustang.png";var lightning=new Image;lightning.src="/images/lightning.png";var messerschmitt=new Image;messerschmitt.src="/images/messerschmitt.png";var planes=[spitfire,zero,mustang,lightning,messerschmitt],bulletImg=new Image;bulletImg.src="/images/bullet.png";var tileMap=new Image;tileMap.src="/images/map-2.png";var map={cols:10,rows:10,tileSize:500};Camera.prototype.move=function(t,e){this.x=t,this.y=e},Maverick.prototype.updateCam=function(t){this.camLeftBound=this.client.x-canvas.width/2,this.camRightBound=this.client.x+canvas.width/2,this.camTopBound=this.client.y-canvas.height/2,this.camBottomBound=this.client.y+canvas.height/2,this.camera.move(this.client.x,this.client.y)},Maverick.prototype.keyPressHandler=function(){var t=this;leftPress&&socket.emit("leftPressed",t.client),rightPress&&socket.emit("rightPressed",t.client),upPress&&socket.emit("upPressed",t.client),upPress||socket.emit("downPressed",t.client)},Maverick.prototype.shiftHandler=function(){var t=this;shiftPress&&socket.emit("shiftPressed",t.client),shiftPress||socket.emit("shiftUp",t.client)},Maverick.prototype.run=function(){this.tick();var t=this;setInterval(function(){t.keyPressHandler.call(t)},30),setInterval(function(){t.shiftHandler.call(t)},150)},Maverick.prototype.tick=function(t){window.requestAnimationFrame(this.tick.bind(this)),this.ctx.clearRect(0,0,1280,960),this.render()},Maverick.prototype.render=function(){this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,this.updateCam(),this.drawMap(),this.drawBullets(),this.drawEnemies(),this.drawPlane(),this.drawLeaderboard(),this.drawLeaders(),this.drawAmmo()},Maverick.prototype.drawMap=function(){this.ctx.save(),this.ctx.drawImage(tileMap,0,0,5e3,5e3,-mav.camLeftBound,-mav.camTopBound,5e3,5e3),this.ctx.restore()},Maverick.prototype.drawPlane=function(){this.ctx.save(),this.ctx.translate(canvas.width/2,canvas.height/2),this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.font="18px 'Lucida Grande'",this.ctx.fillStyle="blue",this.ctx.fillText(this.client.name,0,-85),this.ctx.fillStyle="grey",this.ctx.fillText("Health: "+this.client.health,0,-65),this.ctx.rotate(Math.PI/180*this.client.angle),this.ctx.drawImage(planes[this.client.plane],-60,-60,120,120),this.ctx.restore()},Maverick.prototype.drawEnemies=function(){var t=this;players.length>=1&&players.forEach(function(e){e.id!==t.client.id&&e.x<t.camRightBound&&e.x>t.camLeftBound&&e.y<t.camBottomBound&&e.y>t.camTopBound&&(t.ctx.save(),t.ctx.translate(e.x-t.camLeftBound,e.y-t.camTopBound),t.ctx.textAlign="center",t.ctx.textBaseline="bottom",t.ctx.font="18px 'Lucida Grande'",t.ctx.fillStyle="red",t.ctx.fillText(e.name,0,-85),t.ctx.fillStyle="grey",t.ctx.fillText("Health: "+e.health,0,-65),t.ctx.rotate(Math.PI/180*e.angle),t.ctx.drawImage(planes[e.plane],-60,-60,120,120),t.ctx.restore())})},Maverick.prototype.drawBullets=function(){var t=this;bullets.length>=1&&bullets.forEach(function(e){e.x<t.camRightBound&&e.x>t.camLeftBound&&e.y<t.camBottomBound&&e.y>t.camTopBound&&(t.ctx.save(),t.ctx.translate(e.x-t.camLeftBound,e.y-t.camTopBound),t.ctx.rotate(Math.PI/180*e.angle),t.ctx.drawImage(bulletImg,-12,-12,24,24),t.ctx.restore())})},Maverick.prototype.drawAmmo=function(){for(var t=this,e=canvas.height-64,i=16,a=mav.client.ammo;a>0;a--)t.ctx.drawImage(bulletImg,i,e,48,48),i+=16},Maverick.prototype.drawLeaderboard=function(){this.ctx.globalAlpha=.3,this.fillStyle="black",this.ctx.fillRect(20,20,200,200),this.ctx.globalAlpha=1},Maverick.prototype.drawLeaders=function(){var t=this,e=50;t.ctx.fillStyle="white",t.ctx.font="18px 'Lucida Grande'",t.ctx.fillText("Leaderboard:",35,50),t.ctx.fillStyle="black",leaderboard.forEach(function(i){e+=25,t.ctx.globalAlpha=1,t.ctx.fillStyle="white",t.ctx.font="18px 'Lucida Grande'",t.ctx.fillText(i.name+": "+i.points+" pts",35,e),t.ctx.fillStyle="black"})},$("#start").on("click",function(){plane=$("#select").val();var t=new Client($("#name").val(),plane,socket.id);socket.emit("spawn",t)}),socket.on("joinGame",function(t){canvas.getContext("2d");console.log("Updated Settings:",t);var e=new Client(t.name,t.plane,t.id,t.x,t.y,t.speed,t.angle,t.health,t.points,t.ammo),i=new Camera(map,canvas.width,canvas.height);mav=new Maverick(canvas.getContext("2d"),i,e),$("#menu").hide(),mav.run()}),socket.on("rejoinGame",function(t){mav.client=t}),socket.on("movePlane",function(t){mav.client.x=t.x,mav.client.y=t.y,mav.client.speed=t.speed,mav.client.health=t.health,mav.client.angle=t.angle,mav.client.points=t.points,mav.client.ammo=t.ammo}),socket.on("moveBullets",function(t){bullets=t}),socket.on("updateAllPlayers",function(t){players=t}),socket.on("updateAllLeaderboards",function(t){leaderboard=t}),socket.on("shotFired",function(t){console.log(t.name,"is shooting!")}),socket.on("playerDie",function(t){console.log(t.name,"was shot down!"),t.id===mav.client.id&&($("#inputs").hide(),$("#start").hide(),$("#controls").hide(),$("#select").hide(),$("#reload").show(),$("#menu").show())});